<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Your Watchlist | BingeSync</title>
		<link rel="stylesheet" href="/css/watchlist.css" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
		/>
	</head>

	<body>
		<div class="watchlist-page">
			<!-- ================= HERO SECTION ================= -->
			<section class="hero" style="height: 60vh">
				<img
					src="https://images.unsplash.com/photo-1626814026160-2237a95fc5a0?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&q=80&w=1170"
					alt="Watchlist"
					class="bg-image"
				/>
				<div class="overlay"></div>
				<div
					class="hero-content"
					style="text-align: center; flex-direction: column"
				>
					<h1 style="font-size: 3rem">ðŸŽ¬ Your Watchlist</h1>
					<p style="color: #ccc; margin-top: 10px">
						All your favorite series in one place.
					</p>
				</div>
			</section>

			<!-- ================= RECOMMENDED / WATCHLIST ================= -->
			<section class="recommended">
				<h2>Your Saved Series</h2>

				<% if (watchlist.length === 0) { %>
				<p class="empty-message">
					You haven't added anything yet ðŸ˜…<br />
					Go explore and add some series to your watchlist!
				</p>
				<% } else { %>
				<div class="recommendation-slider">
					<% watchlist.forEach((series) => { %>
					<div class="netflix-card" data-id="<%= series.series_id %>">
						<!-- Delete Button -->
						<button
							class="delete-btn"
							data-id="<%= series.series_id %>"
							title="Remove from Watchlist"
						>
							<i class="fa-solid fa-trash"></i>
						</button>

						<a href="/watchlist/series/<%= series.series_id %>">
							<div class="card-image">
								<img src="<%= series.poster_url %>" alt="<%= series.title %>" />
								<div class="overlay"></div>
							</div>
							<div class="card-info">
								<h3 class="title"><%= series.title %></h3>
								<p class="meta">
									<%= series.genre_name || "Drama" %> â€¢ <%= series.series_rating
									? parseFloat(series.series_rating).toFixed(1) : "8.0" %>
								</p>
							</div>
						</a>
					</div>
					<% }) %>
				</div>
				<% } %>
			</section>
		</div>

		<!-- ================= CONFIRM DELETE MODAL ================= -->
		<div id="confirmModal" class="confirm-modal">
			<div class="confirm-box">
				<h3>Remove from Watchlist?</h3>
				<p>Are you sure you want to delete this series?</p>
				<div class="confirm-actions">
					<button id="cancelDelete" class="cancel-btn">Cancel</button>
					<button id="confirmDelete" class="confirm-btn">Delete</button>
				</div>
			</div>
		</div>

		<!-- ================= TOAST ================= -->
		<div id="toast" class="toast">Removed from Watchlist âœ…</div>

		<!-- ================= SCRIPT ================= -->
		<script>
			let currentDeleteId = null;

			// Open confirm modal
			document.querySelectorAll(".delete-btn").forEach((btn) => {
				btn.addEventListener("click", (e) => {
					e.preventDefault();
					e.stopPropagation();
					currentDeleteId = btn.getAttribute("data-id");
					document.getElementById("confirmModal").classList.add("show");
				});
			});

			// Cancel deletion
			document.getElementById("cancelDelete").addEventListener("click", () => {
				document.getElementById("confirmModal").classList.remove("show");
				currentDeleteId = null;
			});

			// Confirm deletion
			document
				.getElementById("confirmDelete")
				.addEventListener("click", async () => {
					if (!currentDeleteId) return;

					try {
						const res = await fetch(`/watchlist/delete/${currentDeleteId}`, {
							method: "DELETE",
						});
						const data = await res.json();

						if (res.ok) {
							document.querySelector(`[data-id="${currentDeleteId}"]`).remove();
							showToast("âœ… Removed from Watchlist");
						} else {
							showToast("âŒ " + data.message);
						}
					} catch (err) {
						console.error(err);
						showToast("âš ï¸ Error removing series");
					}

					document.getElementById("confirmModal").classList.remove("show");
					currentDeleteId = null;
				});

			// Toast function
			function showToast(message) {
				const toast = document.getElementById("toast");
				toast.textContent = message;
				toast.classList.add("show");
				setTimeout(() => toast.classList.remove("show"), 2500);
			}
		</script>
	</body>
</html>
